<div class="card fade-in">
    <!-- Filter Section -->
    <div class="filters">
        <label for="searchBar">Search Shiurim:</label>
        <input 
            id="searchBar" 
            type="text" 
            [(ngModel)]="searchQuery" 
            (input)="applyFilters()" 
            placeholder="Search by title or Rav" 
        />
        <label for="ravFilter">Filter by Rav:</label>
        <select id="ravFilter" [(ngModel)]="selectedRav" (change)="applyFilters()">
            <option value="">All</option>
            <option *ngFor="let rav of ravList" [value]="rav.id">{{ rav.name }}</option>
        </select>

        <label for="topicFilter">Filter by Topic:</label>
        <select id="topicFilter" [(ngModel)]="selectedTopic" (change)="applyFilters()">
            <option value="">All</option>
            <option *ngFor="let topic of topicList" [value]="topic.id">{{ topic.name }}</option>
        </select>

        <label for="yearFilter">Filter by Year:</label>
        <input id="yearFilter" [(ngModel)]="selectedYear" (change)="applyFilters()" type="number" placeholder="Year" />
    </div>

    <!-- Shiurim Table -->
    <p-table [value]="filteredShiurim" [responsive]="true" [tableStyle]="{ 'padding-right': '8rem', 'padding-left': '8rem', 'padding-bottom': '2rem', 'width':'50%'}">
        <ng-template pTemplate="body" let-shiur let-i="index">
            <tr class="table-row fade-in-row" [style.animation-delay]="i * 0.2 + 's'">
                <td class="td-flex">
                    <img
                        [src]="'../../../assets/IMG_6946.JPG'"
                        [alt]="shiur.rav?.name"
                        class="profile-img"
                    />
                    {{ shiur.title }}<br /><br />
                    {{ shiur.rav?.name }}<br /><br />
                    {{ shiur.date | date: 'mediumDate' }}
                </td>
                <td class="td">{{ shiur.topic?.name }}</td>
                <td class="td-audio">
                    <p-button icon="pi pi-volume-up" [rounded]="true" [text]="true" (onClick)="openAudio(shiur.id)" />
                    <audio *ngIf="audioVisible[shiur.id]" controls preload="none" class="audio-player">
                        <source src="../../../assets/Chamol Kempeh.mp3" type="audio/mp3">
                        <source src="../../../assets/Chamol Kempeh.mp3" type="audio/ogg">
                        <source src="../../../assets/Chamol Kempeh.mp3" type="audio/wav">
                    </audio>
                    
            </tr>
            <br>
        </ng-template>
        <ng-template pTemplate="footer">
            In total there are {{ filteredShiurim.length }} shiurim.
        </ng-template>
    </p-table>
</div>

<style>
    /* Fade-in effect for the card */
    .fade-in {
        opacity: 0;
        transform: translateY(20px);
        animation: fadeInUp 0.8s ease forwards;
    }

    /* Fade-in effect for rows */
    .fade-in-row {
        opacity: 0;
        transform: translateY(20px);
        animation: fadeInUp 0.8s ease forwards;
    }

    /* Animation delay for rows */
    @keyframes fadeInUp {
        0% {
            opacity: 0;
            transform: translateY(20px);
        }
        100% {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* General styles */
    .td {
        border-top: 1px solid rgba(181, 203, 212, 0.9);
        border-bottom: 1px solid rgba(181, 203, 212, 0.9);
    }

    .td-flex {
        border-top: 1px solid rgba(181, 203, 212, 0.9);
        border-bottom: 1px solid rgba(181, 203, 212, 0.9);
        display: flex;
        flex-direction: row;
        gap: 1rem;
    }

    .td-audio {
        border-top: 1px solid rgba(181, 203, 212, 0.9);
        border-bottom: 1px solid rgba(181, 203, 212, 0.9);
        text-align: right;
    }

    .table-row:hover {
        background-color: rgba(240, 240, 240, 0.9);
        transition: background-color 0.3s ease;
    }

    .profile-img {
        object-fit: cover;
        height: 6rem;
        width: 6rem;
        border-radius: 50%;
    }

    .audio-player {
        width: 300px;
        margin-right: 0px;
    }

    /* Medium screens */
    @media (max-width: 768px) {
        .card {
            padding: 1rem;
        }

        .profile-img {
            height: 4rem;
            width: 4rem;
        }

        .audio-player {
            width: 100%;
        }

        p-table {
            font-size: 0.9rem;
        }
    }

    /* Small screens */
    @media (max-width: 576px) {
        .card {
            padding: 0.5rem;
        }

        .profile-img {
            height: 3rem;
            width: 3rem;
        }

        .audio-player {
            width: 100%;
        }

        p-table {
            font-size: 0.8rem;
        }

        .td {
            font-size: 0.8rem;
            padding: 0.5rem;
        }

        tr {
            display: block;
            margin-bottom: 1rem;
        }

        tr .td {
            display: block;
            text-align: left;
        }
    }

    /* Filter Styles */
    .filters {
        margin-bottom: 2rem;
    }

    .filters label {
        font-size: 1rem;
        margin-right: 1rem;
    }

    .filters select,
    .filters input {
        margin: 0 1rem 1rem 0;
        padding: 0.5rem;
        font-size: 1rem;
    }
</style>
